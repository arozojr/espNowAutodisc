import cv2
import numpy as np
import matplotlib.pyplot as plt

# 1. Carrega a imagem
img = cv2.imread("img.png")                # nome da sua imagem
img_rgb = cv2.cvtColor(img, cv2.COLOR_BGR2RGB)

# 2. Converte pra escala de cinza
gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)

# 3. Detecta bordas com Canny
#    Aumente os valores se estiver pegando bordas demais
edges = cv2.Canny(gray, 50, 100)

# (opcional) Engrossa um pouco as bordas, mas bem pouco
kernel = np.ones((2, 2), np.uint8)
edges_dilated = cv2.dilate(edges, kernel, iterations=1)

# 4. Cria máscara booleana (True = borda)
mask = edges_dilated > 0                   # matriz 2D booleana
mask_3ch = np.repeat(mask[:, :, None], 3, axis=2)  # 3 canais

# 5. Cria imagem suavizada
blur = cv2.GaussianBlur(img_rgb, (9, 9), 0)

# 6. Combina: borda = blur, resto = original
result = img_rgb.copy()
result[mask_3ch] = blur[mask_3ch]

# 7. Salva arquivos para conferir
cv2.imwrite("edges.png", edges_dilated)              # pra ver a máscara de bordas
cv2.imwrite("resultado.png", cv2.cvtColor(result, cv2.COLOR_RGB2BGR))\

# ------- (AQUI VEM SEU PROCESSAMENTO) -------
# Supondo que você já tem a imagem "result" gerada antes
# Exemplo fictício:
# result = ...

# Exibir lado a lado
plt.figure(figsize=(15,5))

# Imagem original
plt.subplot(1, 3, 1)
plt.imshow(img_rgb)
plt.title("Original")
plt.axis("off")

# Imagem suavizada
plt.subplot(1, 3, 2)
plt.imshow(result)
plt.title("Suavizada nas Bordas")
plt.axis("off")

# Imagem suavizada
plt.subplot(1, 3, 3)
plt.imshow(edges_dilated)
plt.title("Suavizada nas Bordas")
plt.axis("off")

plt.show()